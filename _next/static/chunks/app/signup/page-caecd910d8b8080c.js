(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{6249:function(){},9116:function(e,t,r){Promise.resolve().then(r.bind(r,4665))},4665:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(1595),o=r(3146),i=r(8582),a=r(6387),s=r(1327),c=r(20),u=r(7180),l=r(4013),d=r(6419),h=r(9507),f=r(7468),v=r(2265),m=r(3996),p=r(3448),g=r(9376),Z=r(4654),y=r(3250),C=r(156);function b(){let[e,t]=(0,C.tN)(),r=(0,g.useRouter)(),[b]=(0,m.fl)(),I=(0,p.PQ)(p.YI.primary.getArgb(b.scheme));(0,p.PQ)(p.YI.onSurface.getArgb(b.scheme)),(0,p.PQ)(p.YI.onSurfaceVariant.getArgb(b.scheme));let P=(0,v.useRef)(null),x=(0,v.useRef)(null),w=(0,v.useRef)(null),k=(0,v.useRef)(null),T=(0,v.useRef)(void 0),S=(0,v.useRef)(),[R,A]=(0,v.useState)("signup"),N=(0,v.useMemo)(()=>new y.AM({UserPoolId:C.ZP,ClientId:C.xh}),[]),Q=async()=>{var e,t,r;let n=null===(e=P.current)||void 0===e?void 0:e.value,o=null===(t=x.current)||void 0===t?void 0:t.value,i=null===(r=w.current)||void 0===r?void 0:r.value;if(!n||!o||!i){(0,Z.yv)("入力してください",{variant:"error"});return}let a="+81".concat(i.replace(/^0/,""));console.log(a);let s=[new y.KC({Name:"email",Value:n}),new y.KC({Name:"phone_number",Value:a})];N.signUp(a,o,s,[],(e,t)=>{if(e){(0,Z.yv)(e.message,{variant:"error"});return}T.current=null==t?void 0:t.user,S.current={phoneNumber:a,password:o},(0,Z.yv)("作成完了。確認コードをメールに送信しました。"),A("confirm")})};return(0,n.BX)("div",{children:[(0,n.tZ)(i.Z,{}),(0,n.BX)("div",{css:(0,o.iv)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"}),children:[(0,n.tZ)(a.Z,{variant:"h4",css:(0,o.iv)({color:I,fontWeight:"bold"}),children:"アカウント作成"}),(0,n.BX)("div",{css:(0,o.iv)({marginTop:16,display:"flex",flexDirection:"column"}),children:[(0,n.BX)(s.Z,{variant:"standard",css:(0,o.iv)({marginTop:16}),children:[(0,n.tZ)(c.Z,{children:"電話番号"}),(0,n.tZ)(u.Z,{inputRef:w,placeholder:"09012345678"})]}),(0,n.BX)(s.Z,{variant:"standard",css:(0,o.iv)({marginTop:8}),children:[(0,n.tZ)(c.Z,{children:"メールアドレス"}),(0,n.tZ)(u.Z,{type:"email",inputRef:P})]}),(0,n.BX)(s.Z,{variant:"standard",css:(0,o.iv)({marginTop:8}),children:[(0,n.tZ)(c.Z,{children:"パスワード"}),(0,n.tZ)(u.Z,{type:"password",inputRef:x})]}),(0,n.BX)("div",{css:(0,o.iv)({marginTop:32,display:"flex",flexDirection:"row",justifyContent:"flex-end"}),children:[(0,n.tZ)(l.Z,{onClick:()=>{r.push("/login")},children:"作成済みのアカウントでログイン"}),(0,n.tZ)(l.Z,{variant:"contained",onClick:Q,children:"アカウント作成"})]})]})]}),(0,n.BX)(d.Z,{open:"confirm"===R,sx:{"& .MuiDialog-paper":{borderRadius:3}},children:[(0,n.tZ)(h.Z,{children:"確認コードを入力"}),(0,n.BX)(f.Z,{css:(0,o.iv)({display:"flex",flexDirection:"column"}),children:[(0,n.BX)(s.Z,{variant:"standard",css:(0,o.iv)({}),children:[(0,n.tZ)(c.Z,{children:"確認コード"}),(0,n.tZ)(u.Z,{inputRef:k})]}),(0,n.tZ)(l.Z,{variant:"contained",css:(0,o.iv)({marginTop:16}),onClick:()=>{var n;let o=null===(n=k.current)||void 0===n?void 0:n.value;if(!o){(0,Z.yv)("confirmation code is required",{variant:"error"});return}let i=T.current;if(!i){(0,Z.yv)("user is not found",{variant:"error"});return}i.confirmRegistration(o,!0,(n,o)=>{if(n){(0,Z.yv)(n.message,{variant:"error"});return}(0,Z.yv)("コード確認: ".concat(o));let a=S.current;if(!a){(0,Z.yv)("user auth info is not found",{variant:"error"});return}i.authenticateUser(new y.sD({Username:a.phoneNumber,Password:a.password}),{onSuccess:function(n){let o=n.getIdToken().getJwtToken();(0,Z.yv)("ログイン成功"),e.apiClient.setNewIdToken(o),t.setStatus("authenticated"),r.push("/user")},onFailure:function(e){(0,Z.yv)("login failed",{variant:"error"}),console.error(e)}})})},children:"確認"})]})]})]})}},8582:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(1595),o=r(4856),i=r(1495),a=r(1004),s=r(6387),c=r(3146),u=r(3996),l=r(3448);function d(){let[e]=(0,u.fl)(),t=(0,l.PQ)(l.YI.primary.getArgb(e.scheme));return(0,l.PQ)(l.YI.onSurface.getArgb(e.scheme)),(0,l.PQ)(l.YI.onSurfaceVariant.getArgb(e.scheme)),(0,n.tZ)(i.Z,{position:"fixed",elevation:0,css:(0,c.iv)({backgroundColor:"transparent",color:t}),children:(0,n.BX)(a.Z,{children:[(0,n.tZ)(o.Z,{sx:{mr:1}}),(0,n.tZ)(s.Z,{variant:"h6",css:(0,c.iv)({fontWeight:"bold"}),children:"推しコール"})]})})}},156:function(e,t,r){"use strict";r.d(t,{ZP:function(){return i},st:function(){return f},tN:function(){return l},xh:function(){return a}});var n=r(1595),o=r(2265);let i="ap-northeast-1_QZrerTmNH",a="7ibhthrioi38cqgoh1a9lco365",s="https://w1w476hjrd.execute-api.ap-northeast-1.amazonaws.com/dev",c=(0,o.createContext)({apiClient:h(s,void 0),status:"loading"}),u=(0,o.createContext)(()=>{}),l=()=>{let e=(0,o.useContext)(c),t=(0,o.useContext)(u);return[e,(0,o.useMemo)(()=>({setStatus:e=>{t({type:"setStatus",payload:{status:e}})}}),[])]},d=(e,t)=>"setStatus"===t.type?{...e,status:t.payload.status}:e;function h(e,t){return{apiGatewayUrl:()=>e,idToken:()=>t,setNewIdToken:e=>{localStorage.setItem("idToken",e),t=e,console.log("setNewIdToken",e)},restoreIdToken:async()=>{let r=localStorage.getItem("idToken");if(r)try{if(!(await fetch("".concat(e,"/user"),{method:"GET",headers:{Authorization:"".concat(r)}})).ok)throw Error("Unauthorized");return t=r,r}catch(e){console.error(e);return}}}}function f(e){let{children:t}=e,[r,i]=(0,o.useReducer)(d,{apiClient:h(s,void 0),status:"loading"}),a=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{a.current||(a.current=!0,r.apiClient.restoreIdToken().then(e=>{i({type:"setStatus",payload:{status:e?"authenticated":"unauthenticated"}})}))},[]),(0,n.tZ)(c.Provider,{value:r,children:(0,n.tZ)(u.Provider,{value:i,children:t})})}},3996:function(e,t,r){"use strict";r.d(t,{ThemeStoreProvider:function(){return p},fl:function(){return v}});var n=r(1595),o=r(5106),i=r.n(o),a=r(2017),s=r(9163),c=r(9026),u=r(3448),l=r(2265),d=r(4049);let h=(0,l.createContext)({scheme:new u.S2(u.OP.fromInt(15569803),!1,0),sourceColor:15569803}),f=(0,l.createContext)(()=>{}),v=()=>{let e=(0,l.useContext)(h),t=(0,l.useContext)(f);return[e,{resetSourceColor:()=>{t({type:"setTheme",payload:{scheme:new u.S2(u.OP.fromInt(15569803),!1,0),sourceColor:15569803}})}}]},m=(e,t)=>{if("setTheme"===t.type){let{scheme:r,sourceColor:n}=t.payload;return e.sourceColor===n?e:{...e,scheme:r,sourceColor:n}}return e},p=e=>{let{children:t}=e,[r,o]=(0,l.useReducer)(m,{scheme:new u.S2(u.OP.fromInt(15569803),!1,0),sourceColor:15569803}),v=(0,a.Z)((0,s.Z)({palette:{mode:"light",primary:{main:(0,u.PQ)(u.YI.primary.getArgb(r.scheme))},secondary:{main:(0,u.PQ)(u.YI.secondary.getArgb(r.scheme))},background:{default:(0,u.PQ)(u.YI.surface.getArgb(r.scheme)),paper:(0,u.PQ)(u.YI.surfaceContainer.getArgb(r.scheme))},error:{main:(0,u.PQ)(u.YI.error.getArgb(r.scheme))},text:{primary:(0,u.PQ)(u.YI.onSurface.getArgb(r.scheme))}},typography:{fontFamily:i().style.fontFamily}}));return(0,n.BX)(c.Z,{theme:v,children:[(0,n.tZ)(d.Z,{styles:e=>({body:{transition:e.transitions.create(["background-color","transform"])}})}),(0,n.tZ)(h.Provider,{value:r,children:(0,n.tZ)(f.Provider,{value:o,children:t})})]})}}},function(e){e.O(0,[957,781,220,654,938,250,433,971,117,744],function(){return e(e.s=9116)}),_N_E=e.O()}]);